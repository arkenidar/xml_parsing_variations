<title>pack html</title>
<meta charset="utf-8">

<div id="pack_this" style="display: none"><div class="msg">HTML text ENCODER</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div><div class="msg">some text</div></div>

<div id="stats"></div>

<div id="packed"></div>

<script>

function processNodesNG(nodes){
    var subNodes=[]
    for(processedNode of nodes){
        subNodes.push(processNodeNG(processedNode))
    }
    return subNodes.join('')
}

function processNodeNG(processedNode){
    switch(processedNode.nodeType){
        case processedNode.TEXT_NODE:
            return processedNode.textContent
            break
        case processedNode.ELEMENT_NODE:
            var produced=[]
            produced.push('{'+processedNode.tagName.toLowerCase())
            var attribute_section=[]
            for(attribute of processedNode.attributes)
                attribute_section.push(attribute.nodeName+'|'+attribute.nodeValue)
            produced.push(...attribute_section)
            if(processedNode.childNodes){
                var sub=processNodesNG(processedNode.childNodes)
                if(sub!='')produced.push(sub)
            }
            return produced.join('|')+'}'
            break
    }
}

function pack(node){
    return processNodesNG(node.childNodes)
}
function $(id){
    return document.getElementById(id)
}

$('packed').innerHTML=pack($('pack_this'))
$('stats').innerHTML='reduced of '+($('pack_this').innerHTML.length-$('packed').innerHTML.length)+' of '+$('pack_this').innerHTML.length
</script>
